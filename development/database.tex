\subsection{Физическое проектирование базы данных}
В процессе разработки возник вопрос как организовать физическое изменение
структуры базы данных. Классический подход создания структуры базы данных для
конкретной СУБД - код на языке SQL. Такой подход удобен если структура базы
создается единожды и не меняется в процессе разработки. На практике структура
базы данных меняется очень часто. Ситуация усугубляется если структуру базы
данных могут менять несколько разработчиков одновременно. Система контроля
версий может решить данную проблему, но лишь частично.

\subsubsection{Миграции}
Ruby On Rails предлагает встроенный механизм миграций. Миграции - это
методолигия позволяющая решить проблему изменения структуры базы данных при
разработке. Миграция представляет собой код, способный изменить структуру базы
данных.
Основные идеи:
\begin{enumerate}
  \item изменения в структуре базы данных должны быть атомарными;
  \item каждое атомарное изменение оформляется в виде миграции;
  \item должна быть возможность возвращать структуру базы данных к выбранному
состоянию.
\end{enumerate}

Каждая миграция снабжается временной меткой, характеризующей время создания
миграции. По этим временным веткам происходит упорядочивание порядка выполенения
миграций. Фиксация выполненных миграций производится на уровне базы данных в
специальной таблице “schema\_migrations”. В таблицу заносятся временные метки
выполненных миграций.

\begin{lstlisting}[language=Ruby,caption=Пример миграций
,label={lst:migration_example}] 
class CreateBids < ActiveRecord::Migration
  def change
    create_table :bids do |t|
      t.string      :first_name,    :null => false
      t.string      :last_name,     :null => false
      t.string      :third_name,    :null => true
      t.string      :address,       :null => false
      t.string      :policy,        :null => false
      t.string      :passport_scan, :null => false
      t.string      :status,        :null => false, :default => 'created'
      t.timestamps
    end
  end
end
\end{lstlisting}

В листинге \ref{lst:migration_example} представлен пример миграции, создающей в
базе данных таблицу для хранения заявок на регистрацию.
